syntax = "proto3";

package lynx.protobuf.plugin.db;

option go_package = "github.com/go-lynx/lynx/app/log/conf";

// Defines a message type for log system configuration.
message log {
  // The log level: debug, info, warn, error, etc.
  string level = 1;

  // The file path where logs should be written.
  string file_path = 2;

  // Whether to also output logs to the console.
  bool console_output = 3;

  // The maximum size of a single log file before rotation.
  int32 max_size_mb = 4;

  // The maximum number of backup log files to keep.
  int32 max_backups = 5;

  // The maximum number of days to retain old log files.
  int32 max_age_days = 6;

  // Whether to compress rotated log files.
  bool compress = 7;

  // Stack trace capture configuration.
  message Stack {
    // Whether to enable stack capture.
    bool enable = 1;

    // Minimum level to capture stack: debug|info|warn|error|fatal
    string level = 2;

    // Number of frames to skip from the top of the stack.
    int32 skip = 3;

    // Maximum number of frames to capture.
    int32 max_frames = 4;

    // Frame prefixes to filter out (package/file prefixes).
    repeated string filter_prefixes = 5;
  }

  // Stack trace config at top-level log config.
  Stack stack = 8;

  // Caller skip depth for caller() extraction.
  int32 caller_skip = 9;

  // Timezone name for logging timestamps, e.g. "Asia/Shanghai" or "UTC".
  string timezone = 10;

  // Sampling and rate limit configuration.
  message Sampling {
    // Enable sampling/ratelimiting.
    bool enable = 1;

    // Fraction 0..1 to keep info logs.
    float info_ratio = 2;

    // Fraction 0..1 to keep debug logs.
    float debug_ratio = 3;

    // Max info logs per second (0 = unlimited).
    int32 max_info_per_sec = 4;

    // Max debug logs per second (0 = unlimited).
    int32 max_debug_per_sec = 5;
  }

  // Sampling config.
  Sampling sampling = 11;
}
