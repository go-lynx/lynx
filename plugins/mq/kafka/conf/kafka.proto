syntax = "proto3";

package lynx.protobuf.plugin.kafka;

option go_package = "github.com/go-lynx/lynx/plugins/mq/kafka/conf;conf";

import "google/protobuf/duration.proto";

// Kafka message defines the configuration information for Kafka client
message Kafka {
  // brokers represents the address list of Kafka cluster
  repeated string brokers = 1;

  // producers multiple producer instance configurations
  repeated Producer producers = 2;

  // consumers multiple consumer instance configurations
  repeated Consumer consumers = 3;

  // Common configurations
  // sasl authentication configuration
  SASL sasl = 4;
  // tls configuration object
  TLS tls = 5;
  // Connection timeout
  google.protobuf.Duration dial_timeout = 6;
}

// Producer configuration
message Producer {
  // Whether to enable producer
  bool enabled = 1;
  // Acknowledgment level: -1=all ISR, 1=leader only, 0=no acknowledgment required
  int32 required_acks = 2;
  // Maximum number of retries
  int32 max_retries = 3;
  // Retry interval
  google.protobuf.Duration retry_backoff = 4;
  // Batch send size
  int32 batch_size = 5;
  // Batch send waiting time
  google.protobuf.Duration batch_timeout = 6;
  // Compression type: none, gzip, snappy, lz4, zstd
  string compression = 7;
  // Instance name (for differentiation, routing), do not reuse occupied tags
  string name = 8;
  // Optional: list of allowed topics to send, for routing/permissions
  repeated string topics = 9;
}

// Consumer configuration
message Consumer {
  // Whether to enable consumer
  bool enabled = 1;
  // Consumer group ID
  string group_id = 2;
  // Auto commit interval
  google.protobuf.Duration auto_commit_interval = 3;
  // Whether to auto commit
  bool auto_commit = 4;
  // Consumption start position: latest, earliest
  string start_offset = 5;
  // Maximum processing concurrency
  int32 max_concurrency = 6;
  // Minimum batch size
  int32 min_batch_size = 7;
  // Maximum batch size
  int32 max_batch_size = 8;
  // Maximum waiting time
  google.protobuf.Duration max_wait_time = 9;
  // Rebalance timeout
  google.protobuf.Duration rebalance_timeout = 10;
  // Instance name (for differentiation/routing)
  string name = 11;
  // Subscribed topic list (or extended to pattern in the future)
  repeated string topics = 12;
}

// SASL authentication configuration
message SASL {
  // Whether to enable SASL
  bool enabled = 1;
  // Authentication mechanism: PLAIN, SCRAM-SHA-256, SCRAM-SHA-512
  string mechanism = 2;
  // Username
  string username = 3;
  // Password
  string password = 4;
}

// TLS configuration
message TLS {
  // Whether to enable TLS
  bool enabled = 1;
  // Root CA certificate file path
  string ca_file = 2;
  // Client certificate file path (optional, for mutual authentication)
  string cert_file = 3;
  // Client private key file path (optional, for mutual authentication)
  string key_file = 4;
  // Whether to skip server certificate verification (not recommended)
  bool insecure_skip_verify = 5;
  // Specify SNI/certificate verification domain name
  string server_name = 6;
}
