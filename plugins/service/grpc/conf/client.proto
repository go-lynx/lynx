syntax = "proto3";

package lynx.protobuf.plugin.grpc.client;

option go_package = "github.com/go-lynx/lynx/plugins/service/grpc/conf;conf";

import "google/protobuf/duration.proto";

// The grpc_client message defines the configuration information for the gRPC client plugin.
message grpc_client {
  // Default timeout for gRPC client requests
  google.protobuf.Duration default_timeout = 1;

  // Default keep-alive interval for gRPC connections
  google.protobuf.Duration default_keep_alive = 2;

  // Maximum number of retries for failed requests
  int32 max_retries = 3;

  // Backoff duration between retries
  google.protobuf.Duration retry_backoff = 4;

  // Maximum number of connections per service
  int32 max_connections = 5;

  // Enable TLS for gRPC client connections
  bool tls_enable = 6;

  // TLS authentication type
  int32 tls_auth_type = 7;

  // Enable connection pooling
  bool connection_pooling = 8;

  // Connection pool size
  int32 pool_size = 9;

  // Connection idle timeout
  google.protobuf.Duration idle_timeout = 10;

  // Enable health checking for connections
  bool health_check_enabled = 11;

  // Health check interval
  google.protobuf.Duration health_check_interval = 12;

  // Enable metrics collection
  bool metrics_enabled = 13;

  // Enable distributed tracing
  bool tracing_enabled = 14;

  // Enable request logging
  bool logging_enabled = 15;

  // Maximum message size in bytes
  int32 max_message_size = 16;

  // Enable compression
  bool compression_enabled = 17;

  // Compression type (gzip, deflate, etc.)
  string compression_type = 18;

  // Service subscription configurations for service discovery
  repeated subscribe_service subscribe_services = 19;

  // Legacy static service configurations (deprecated, use subscribe_services instead)
  repeated static_service services = 20 [deprecated = true];
}

// Configuration for subscribing to services via service discovery
message subscribe_service {
  // Service name for service discovery
  string name = 1;

  // Optional: Static endpoint override (only used when service discovery is unavailable)
  // When using service discovery (like Polaris), this field should be empty
  string endpoint = 2;

  // Service-specific timeout override
  google.protobuf.Duration timeout = 3;

  // Enable TLS for this specific service
  bool tls_enable = 4;

  // TLS authentication type for this service
  int32 tls_auth_type = 5;

  // Maximum retries for this service
  int32 max_retries = 6;

  // Whether this service is required at startup
  bool required = 7;

  // Service-specific metadata
  map<string, string> metadata = 8;

  // Load balancing strategy (round_robin, random, weighted_round_robin, etc.)
  string load_balancer = 9;

  // Circuit breaker configuration
  bool circuit_breaker_enabled = 10;

  // Circuit breaker failure threshold
  int32 circuit_breaker_threshold = 11;
}

// Legacy static service configuration (deprecated)
message static_service {
  option deprecated = true;
  
  // Service name
  string name = 1;

  // Static endpoint
  string endpoint = 2;

  // Service-specific timeout
  google.protobuf.Duration timeout = 3;

  // Enable TLS for this service
  bool tls_enable = 4;

  // TLS authentication type
  int32 tls_auth_type = 5;

  // Maximum retries for this service
  int32 max_retries = 6;
}

